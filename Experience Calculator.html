<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Brighter Shores XP Calculator</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #1e1e2f;
      color: #f0f0f0;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 1.6rem;
      min-height: 100vh;
    }
    .content {
      display: flex;
      flex-direction: row;
      justify-content: center;
      align-items: stretch; /* Ensure both containers stretch to match heights */
      gap: 1.6rem;
      width: 100%;
      max-width: 720px;
    }
    .container {
      background-color: #2c2c3c;
      padding: 1.6rem;
      border-radius: 9.6px;
      max-width: 320px;
      width: 100%;
      box-shadow: 0 0 12px rgba(0,0,0,0.3);
    }
    h2 {
      text-align: center;
      font-size: 1.6rem;
    }
    label, input {
      display: block;
      width: 100%;
      margin-bottom: 0.8rem;
    }
    input[type="number"] {
      padding: 0.4rem;
      border-radius: 4.8px;
      border: none;
      font-size: 0.8rem;
      -webkit-appearance: none;
      -moz-appearance: textfield;
    }
    input[type="number"]::-webkit-inner-spin-button,
    input[type="number"]::-webkit-outer-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
    button {
      padding: 0.56rem;
      width: 100%;
      background-color: #4caf50;
      border: none;
      border-radius: 4.8px;
      color: white;
      font-size: 0.8rem;
      cursor: pointer;
    }
    button:hover {
      background-color: #45a049;
    }
    #result {
      margin-top: 1.2rem;
      font-size: 0.96rem;
    }
    #error {
      color: #ff5555;
      margin-top: -0.4rem;
      margin-bottom: 0.8rem;
      display: none;
    }
    .highlight {
      color: #00ff00 !important;
      font-weight: bold;
    }
    .bottom-image {
      margin-top: 1.6rem;
      max-width: 100%;
      height: auto;
    }
    .footer {
      text-align: center;
      font-size: 0.8rem;
      margin-top: auto;
      padding-bottom: 1.6rem;
    }
    p {
      font-size: 0.8rem;
    }
    .xp-image {
      width: 352px; /* Match calculator container total width (320px + 2*16px padding) */
      background-color: #2c2c3c;
      border-radius: 9.6px;
      padding: 1.6rem;
      box-shadow: 0 0 12px rgba(0,0,0,0.3);
      box-sizing: border-box;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .xp-image img {
      max-width: 100%; /* Scale image to fit container width */
      max-height: 100%; /* Scale image to fit container height */
      width: auto; /* Maintain aspect ratio */
      height: auto; /* Maintain aspect ratio */
      object-fit: contain; /* Ensure no distortion */
    }
  </style>
</head>
<body>
  <div class="content">
    <div class="container">
      <h2>Brighter Shores XP Calculator</h2>
      <p style="text-align: center;">Use this calculator to find out how many kills you need to reach your target level in Brighter Shores, factoring in any XP penalties. Enter your current level, target level, XP per kill, and penalty percentage (between -25 and 0).</p>
      <label>Penalty Percentage:</label>
      <input type="number" id="penalty" value="0" oninput="validatePenalty(); updateImageHeight()">
      <div id="error">Invalid number. Please enter a value from -25 to 0.</div>

      <label>Current Level:</label>
      <input type="number" id="currentLevel" value="1" oninput="updateImageHeight()">

      <label>Target Level:</label>
      <input type="number" id="targetLevel" value="10" oninput="updateImageHeight()">

      <label>XP per Kill:</label>
      <input type="number" id="xpPerKill" value="100" oninput="updateImageHeight()">

      <button onclick="calculateKills()">Calculate</button>
      <div id="result"></div>
    </div>

    <div class="xp-image">
      <img src="https://i.imgur.com/G0sLkqV.png" alt="XP Curve">
    </div>
  </div>

  <div class="footer">
    <p>Combat EXP curve, credit: brightershoreswiki.org <br><br>
      <img src="Brighter%20Shores%20XP%20Calculator_files/J2SWwM5.png" alt="" class="bottom-image"><br><br>
    </p>
  </div>

  <script>
    /**
     * Updates the height of the .xp-image container to match the .container height.
     */
    function updateImageHeight() {
      const container = document.querySelector('.container');
      const xpImage = document.querySelector('.xp-image');
      const containerHeight = container.offsetHeight;
      xpImage.style.height = `${containerHeight}px`;
    }

    /**
     * Calculates the Album XP (A) for a given level (L).
     * Uses a quadratic formula for levels 0-799 and a linear formula for levels 800+.
     * @param {number} L - The level to calculate Album XP for.
     * @returns {number} The Album XP value.
     */
    function albumXP(L) {
      if (L <= 799) {
        const mod2L = (2 * L) % 5;
        const extra_condition = Math.floor((L - 85) / 168) + 1;
        const extra = mod2L < Math.max(0, extra_condition) ? 5 : 0;
        const term = (245 + mod2L + extra) / 10;
        return Math.ceil(0.3 * L ** 2 + term * L + 250);
      } else {
        return 175 * L + 250;
      }
    }

    /**
     * Calculates the XP required to advance to the next level based on level (L) and Album XP (A).
     * Applies a multiplier that varies by level range.
     * @param {number} L - The current level.
     * @param {number} A - The Album XP for the level.
     * @returns {number} The XP needed for the next level.
     */
    function xpForLevel(L, A) {
      let mult = 160;
      if (L <= 5) mult = 2;
      else if (L <= 11) mult = 4;
      else if (L <= 19) mult = 8;
      else if (L <= 799) mult = 40;
      return mult * A;
    }

    /**
     * Computes the total XP required to reach a specific level from level 1.
     * @param {number} L - The target level.
     * @returns {number} The total XP needed.
     */
    function totalXPToLevel(L) {
      let total = 0;
      for (let lvl = 1; lvl < L; lvl++) {
        const A = albumXP(lvl);
        total += xpForLevel(lvl, A);
      }
      return total;
    }

    /**
     * Validates the penalty input, ensuring it stays between -25 and 0.
     * Converts positive values to negative and displays an error if out of range.
     */
    function validatePenalty() {
      const penaltyInput = document.getElementById('penalty');
      const error = document.getElementById('error');
      let value = parseFloat(penaltyInput.value);

      if (!isNaN(value) && value > 0) {
        value = -Math.abs(value);
        penaltyInput.value = value;
      }

      if (isNaN(value) || value < -25 || value > 0) {
        error.style.display = 'block';
      } else {
        error.style.display = 'none';
      }
      updateImageHeight(); // Update height after validation
    }

    /**
     * Calculates the number of kills needed to reach the target level from the current level.
     * Accounts for XP per kill and any penalty percentage.
     */
    function calculateKills() {
      const penaltyInput = document.getElementById('penalty');
      const error = document.getElementById('error');

      if (error.style.display === 'block') {
        document.getElementById('result').innerText = "Fix the penalty value before calculating.";
        return;
      }

      const penalty = parseFloat(penaltyInput.value);
      const currentLevel = parseInt(document.getElementById('currentLevel').value);
      const targetLevel = parseInt(document.getElementById('targetLevel').value);
      const xpPerKill = parseFloat(document.getElementById('xpPerKill').value);

      if (currentLevel < 0 || targetLevel < 0 || xpPerKill <= 0) {
        document.getElementById('result').innerText = "Please enter valid positive values.";
        return;
      }

      if (targetLevel <= currentLevel) {
        document.getElementById('result').innerText = "No Kills needed. Target level already reached.";
        return;
      }

      const xpNow = totalXPToLevel(currentLevel);
      const xpTarget = totalXPToLevel(targetLevel);
      let xpNeeded = xpTarget - xpNow;

      xpNeeded *= (1 + Math.abs(penalty) / 100);

      const kills = Math.ceil(xpNeeded / xpPerKill);

      document.getElementById('result').innerHTML = `You need approximately <span class="highlight">${kills.toLocaleString()}</span> kills.`;
      updateImageHeight(); // Update height after calculation
    }

    // Initial height update on page load
    window.addEventListener('load', updateImageHeight);
    // Update height on window resize
    window.addEventListener('resize', updateImageHeight);
  </script>
</body>
</html>
